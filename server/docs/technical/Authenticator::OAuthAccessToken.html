<!--
	Copyright (C) 2019-2022 Jan Frode Jæger <jan.frode.jaeger@ntnu.no>, NTNU, Trondheim, Norway
	Copyright (C) 2019-2022 Bård Tesaker <bard.tesaker@ntnu.no>, NTNU, Trondheim, Norway

       This file is part of AURORA, a system to store and manage science data.

       AURORA is free software: you can redistribute it and/or modify it under
       the terms of the GNU General Public License as published by the Free
       Software Foundation, either version 3 of the License, or (at your option)
       any later version.

       AURORA is distributed in the hope that it will be useful, but WITHOUT ANY
       WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
       FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.

       You should have received a copy of the GNU General Public License along with
       AURORA. If not, see <https://www.gnu.org/licenses/>.

-->
<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title></title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@localhost" />
</head>

<body>



<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#CONSTRUCTOR">CONSTRUCTOR</a></li>
  <li><a href="#METHODS">METHODS</a>
    <ul>
      <li><a href="#define">define()</a></li>
      <li><a href="#validate">validate()</a></li>
      <li><a href="#generate">generate()</a></li>
    </ul>
  </li>
</ul>

<h1 id="NAME">NAME</h1>

<p><code>Authenticator::OAuthAccessToken</code> - Class to handle authentication of AURORA REST-server by trusting a OAuth-servers access token.</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<p>It follows the same use as the Authenticator-class. See the Authenticator placeholder class for more information.</p>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>A class that inherits from the Authenticator placeholder class. Please see there for more information.</p>

<h1 id="CONSTRUCTOR">CONSTRUCTOR</h1>

<p>See the Authenticator placeholder class for more information.</p>

<h1 id="METHODS">METHODS</h1>

<h2 id="define">define()</h2>

<p>See description in the placeholder Authenticator-class.</p>

<h2 id="validate">validate()</h2>

<p>Validates to the AURORA REST-server by using an OAuth access token. The access token is passed to the generate()-method for checking of the formatting.</p>

<p>There are certain settings from the settings-file that the Settings-instance delivers and the method expects or takes the following options:</p>

<ul>

<li><p><b>system.auth.oauthaccesstoken.audience</b> OAuth audience ID that are defined by the resource server. See RFC6749 for details on the OAuth flow. Required.</p>

</li>
<li><p><b>system.auth.oauthaccesstoken.host</b> Host name of the OAuth resource server (see RFC6749). Required.</p>

</li>
<li><p><b>system.auth.oauthaccesstoken.endpoint</b> Endpoint URL on the resource server where the user information can be fetched by using the access token. Required.</p>

</li>
<li><p><b>system.auth.oauthaccesstoken.emailfield</b> Name of the key in the returned endpoint HASH that identifies the users email address. It is of type LIST and can therefore facilitate addressing sub-keys of a HASH. Required, but will default to [&quot;email&quot;].</p>

</li>
<li><p><b>system.auth.oauthaccesstoken.namefield</b> Name of the key in the returned endpoint HASH that identifies the users full name. It is of type LIST and can therefore facilitate addressing sub-keys of a HASH. Required.</p>

</li>
<li><p><b>system.auth.oauthaccesstoken.userfield</b> Name of the key in the returned endpoint HASH that identifies the users username. It is of type LIST and can therefore facilitate addressing sub-keys of a HASH. Required.</p>

</li>
<li><p><b>system.auth.oauthaccesstoken.createuser</b> If the user is not found the AURORA database the module can create the account. This settings tells the module if it is ok to create the account in such an instance. Optional, will default to 0. Set to 1 to create account.</p>

</li>
<li><p><b>system.auth.oauthaccesstoken.createsorted</b> Sets if the possible creation of a user account sorts the results in sub-keys based on the first letter in the accounts name. Optional. Valid values are 0 (disabled), 1 (enabled). When not set it defaults to 0.</p>

</li>
<li><p><b>system.auth.oauthaccesstoken.userparent</b> If the user is to be created in instances where it does not exist in the AURORA database, this setting tell the module which entity id in the AURORA database is the parent of such an user-account. It is optional and will default to 1 (the root entity).</p>

</li>
<li><p><b>system.auth.oauthaccesstoken.usergroup</b> If the user is to be created in instances where it does not exist in the AURORA database, this setting tell the module which group id the user should be added as a member of. It is optional and will default to not adding the user to any group if it is undefined, 0 or lower.</p>

</li>
</ul>

<p>It calls the generate()-method on the authentication string (access token) and upon successful checking and cleaning, will use the access token to connect to the resource server to get the users email- and name details. These details will be checked in the AURORA database to see if there are any matches? Upon successful match, the entity id of the user will be returned (userid).</p>

<p>If the user cannot be found in the AURORA database, it checks if it is allowed to create the user (see options above)? If it is allowed to create the user, it will to so in the AURORA database and set the email and then return the entity id of the newly created user as the userid.</p>

<p>It returns the AURORA database userid (entity id - int) of the user upon success or 0 upon user not found.</p>

<p>Undef is returned upon failure. Check the error()-method for more information.</p>

<p>See description in the placeholder Authenticator-class for more information on the framework itself.</p>

<h2 id="generate">generate()</h2>

<p>Takes the authentication string (in this case OAuth access token) and checks the validity of the characters and cuts the length at a maximum of 4096 characters.</p>

<p>Returns the cleaned and accepted access token upon success.</p>

<p>Undef is returned upon failure. In such a case check the error()-method for more information.</p>

<p>See description in the placeholder Authenticator-class for more information on the framework itself.</p>


</body>

</html>


